# Buhurt Fight Tracker - File Index

> Reference file for quickly locating files without bash commands.
> Last updated: 2026-02-17

---

## Root Level

| File | Description |
|------|-------------|
| `.claude/CLAUDE.md` | AI assistant guide with TDD/BDD workflow, architecture patterns, and coding standards |
| `PROGRESS.md` | Single source of truth for project status, phase completion, and session logs |
| `DECISIONS.md` | Architectural decision records and open questions with rationale |
| `SYNC_GUIDE.md` | Multi-agent coordination guide for Claude instances |
| `BDD_SCENARIOS_OVERVIEW.md` | Complete BDD scenarios documentation for all features |
| `README.md` | High-level project description (minimal content, TODO) |
| `alembic.ini` | Alembic migration config with SQLAlchemy URL settings |
| `pytest.ini` | Pytest config with asyncio mode, markers, and coverage settings |
| `requirements.txt` | Python dependencies (FastAPI, SQLAlchemy, pytest, testcontainers, etc.) |
| `.python-version` | Python version spec for pyenv |
| `.gitignore` | Git ignore patterns |
| `.coverage` | Coverage data file generated by pytest-cov |

---

## `app/` - Core Application

| File | Description |
|------|-------------|
| `app/main.py` | FastAPI app entry point; CORS middleware, router inclusion, health check endpoint |
| `app/exceptions.py` | All custom exceptions: CountryNotFoundError, DuplicateCountryCodeError, TeamNotFoundError, FighterNotFoundError, FightNotFoundError, TagTypeNotFoundError, TagNotFoundError, DuplicateTagError, DuplicateVoteError, etc. |

### `app/core/`

| File | Description |
|------|-------------|
| `app/core/config.py` | Loads env vars for app settings, DB URL, API prefix, debug mode |
| `app/core/database.py` | Async SQLAlchemy engine, session factory, `get_db()` dependency |

### `app/models/`

| File | Description |
|------|-------------|
| `app/models/country.py` | Country ORM model; UUID pk, name, code, soft delete, timestamps |
| `app/models/team.py` | Team model; FK to Country, eager-loads country and fighters |
| `app/models/fighter.py` | Fighter model; FK to Team, aliases, age, participations relationship |
| `app/models/fight.py` | Fight model; date, location, soft delete, relationships to participants and tags |
| `app/models/fight_participation.py` | Junction table linking fighters to fights; side (RED/BLUE) and captain flag |
| `app/models/tag_type.py` | TagType model; categorizes tags (e.g., fight_format, weapon_type) |
| `app/models/tag.py` | Tag model; FK to TagType, self-referential parent_tag_id for hierarchy |
| `app/models/tag_change_request.py` | TagChangeRequest model (v2); tracks proposed tag changes with status |
| `app/models/vote.py` | Vote model (v2); tracks votes on tag change requests with session-based fraud prevention |

### `app/schemas/`

| File | Description |
|------|-------------|
| `app/schemas/country.py` | Pydantic schemas: CountryCreate, CountryUpdate, CountryResponse |
| `app/schemas/team.py` | Pydantic schemas: TeamCreate, TeamUpdate, TeamResponse (nested country) |
| `app/schemas/fighter.py` | Pydantic schemas: FighterCreate, FighterUpdate, FighterResponse |
| `app/schemas/fight.py` | Pydantic schemas: FightCreate (with participations), FightResponse, ParticipationCreate |
| `app/schemas/tag_type_schema.py` | Pydantic schemas: TagTypeCreate, TagTypeUpdate, TagTypeResponse (max 50 chars) |
| `app/schemas/tag_schema.py` | Pydantic schemas: TagCreate, TagUpdate, TagResponse (max 100 chars, parent support) |

### `app/repositories/`

| File | Description |
|------|-------------|
| `app/repositories/country_repository.py` | CountryRepository; CRUD with soft-delete filtering |
| `app/repositories/team_repository.py` | TeamRepository; CRUD with country FK, eager loading of country and fighters |
| `app/repositories/fighter_repository.py` | FighterRepository; CRUD with team FK, eager loading of team and participations |
| `app/repositories/fight_repository.py` | FightRepository; CRUD with eager loading of participants and tags |
| `app/repositories/fight_participation_repository.py` | FightParticipationRepository; manages fighter-fight junction table |
| `app/repositories/tag_type_repository.py` | TagTypeRepository; CRUD with duplicate name checking |
| `app/repositories/tag_repository.py` | TagRepository; CRUD with tag_type validation, parent tag hierarchy support |
| `app/repositories/tag_change_request_repository.py` | TagChangeRequestRepository (v2); manages tag change proposals |
| `app/repositories/vote_repository.py` | VoteRepository (v2); manages votes with session-based fraud prevention |

### `app/services/`

| File | Description |
|------|-------------|
| `app/services/country_service.py` | CountryService; validates duplicate codes, required fields |
| `app/services/team_service.py` | TeamService; validates country exists before creation |
| `app/services/fighter_service.py` | FighterService; validates team exists, fighter-specific business rules |
| `app/services/fight_service.py` | FightService; complex validation for singles vs melee formats, atomic creation with tags |
| `app/services/tag_type_service.py` | TagTypeService; validates unique names, required fields |
| `app/services/tag_service.py` | TagService; validates tag_type exists, parent hierarchy support |

### `app/api/v1/`

| File | Description |
|------|-------------|
| `app/api/v1/__init__.py` | Combines all entity routers into v1 API router |
| `app/api/v1/countries.py` | Country endpoints: POST, GET list, GET by id, PATCH, DELETE |
| `app/api/v1/teams.py` | Team endpoints: POST, GET list, GET by id, PATCH, DELETE |
| `app/api/v1/fighters.py` | Fighter endpoints: POST, GET list, GET by id, PATCH, DELETE |
| `app/api/v1/fights.py` | Fight endpoints: POST (with participations and format), GET list, GET by id, PATCH, DELETE |
| `app/api/v1/tag_type_controller.py` | TagType endpoints: POST, GET list, GET by id, PATCH, DELETE |
| `app/api/v1/tag_controller.py` | Tag endpoints: POST, GET list, GET by id, PATCH, DELETE |

---

## `tests/` - Test Suite

| File | Description |
|------|-------------|
| `tests/conftest.py` | Shared pytest fixtures: postgres_container (session-scoped), db_engine, mock fixtures |

### `tests/features/` - BDD Gherkin Scenarios

| File | Description |
|------|-------------|
| `tests/features/country_management.feature` | 21 BDD scenarios for Country CRUD and validation |
| `tests/features/team_management.feature` | 40+ BDD scenarios for Team CRUD and country validation |
| `tests/features/fighter_management.feature` | 37 BDD scenarios for Fighter CRUD and team validation |
| `tests/features/fight_management.feature` | 40+ BDD scenarios for Fight CRUD, format validation, and participation rules |
| `tests/features/fight_creation.feature` | BDD scenarios for fight creation workflow and authorization |
| `tests/features/tag_type.feature` | BDD scenarios for TagType CRUD and validation |
| `tests/features/tag.feature` | BDD scenarios for Tag CRUD and validation |
| `tests/features/tag_hierarchy.feature` | 8 scenarios for tag parent-child relationships and cascading soft deletes |
| `tests/features/tag_voting.feature` | 11 scenarios for community voting on tag change requests (v2) |
| `tests/features/data_integrity_1.feature` | BDD scenarios for referential integrity constraints |

### `tests/unit/repositories/`

| File | Description |
|------|-------------|
| `tests/unit/repositories/test_country_repository.py` | 48 unit tests for CountryRepository; CRUD, soft delete, eager loading |
| `tests/unit/repositories/test_team_repository.py` | 48 unit tests for TeamRepository; CRUD, FK validation, relationships |
| `tests/unit/repositories/test_fighter_repository.py` | 34 unit tests for FighterRepository; CRUD, team validation, relationships |
| `tests/unit/repositories/test_fight_repository.py` | Unit tests for FightRepository; fight CRUD, participation relationships |
| `tests/unit/repositories/test_fight_participation_repository.py` | Unit tests for FightParticipationRepository; junction table operations |
| `tests/unit/repositories/test_tag_type_repository.py` | 19 unit tests for TagTypeRepository; CRUD, duplicate checking |
| `tests/unit/repositories/test_tag_repository.py` | 9 unit tests for TagRepository; CRUD, hierarchy support |

### `tests/unit/services/`

| File | Description |
|------|-------------|
| `tests/unit/services/test_country_service.py` | Unit tests for CountryService; business logic and exception handling |
| `tests/unit/services/test_team_service.py` | 48 unit tests for TeamService; creation validation, country existence checks |
| `tests/unit/services/test_fighter_service.py` | 34 unit tests for FighterService; team validation, fighter business rules |
| `tests/unit/services/test_fight_service.py` | 24 unit tests for FightService; singles vs melee validation, atomic creation |
| `tests/unit/services/test_tag_type_service.py` | 19 unit tests for TagTypeService; CRUD, duplicate name validation |
| `tests/unit/services/test_tag_service.py` | 6 unit tests for TagService; CRUD, tag_type validation, parent hierarchy |

### `tests/integration/`

| File | Description |
|------|-------------|
| `tests/integration/README.md` | Explains Testcontainers setup, Docker requirements, test execution |
| `tests/integration/repositories/test_country_repository_integration.py` | 14 integration tests for CountryRepository against real PostgreSQL |
| `tests/integration/repositories/test_team_repository_integration.py` | 15 integration tests for TeamRepository with real FK constraints |
| `tests/integration/repositories/test_fighter_repository_integration.py` | 12 integration tests for FighterRepository with real DB |
| `tests/integration/api/test_tag_type_integration.py` | 8 integration tests for TagType HTTP API endpoints |
| `tests/integration/api/test_tag_integration.py` | 9 integration tests for Tag HTTP API endpoints |
| `tests/integration/api/test_fight_integration.py` | 6 integration tests + 1 skipped for Fight HTTP API |

### `tests/step_defs/`

| File | Description |
|------|-------------|
| `tests/step_defs/country_steps.py` | BDD step definitions for country scenarios (legacy) |

---

## `alembic/versions/` - Database Migrations

| File | Description |
|------|-------------|
| `ab555486...` | Creates `countries` table with UUID PK, is_deleted, unique code |
| `6dc2dfcf...` | Creates `teams` table with country_id FK |
| `a1b2c3d4...` | Creates `fighters` table with team_id FK, aliases, age |
| `f1a2b3c4...` | Creates `fights` table with date, location, soft delete |
| `g2b3c4d5...` | Creates `fight_participations` junction table with side and captain |
| `h3c4d5e6...` | Creates `tag_types` table with unique name constraint |
| `i4d5e6f7...` | Creates `tags` table with self-referential parent_tag_id |
| `j5e6f7g8...` | Seeds fight_format TagType with "singles" and "melee" tag values |

---

## `docs/`

| File | Description |
|------|-------------|
| `docs/data-model.md` | ER diagram showing Country → Team → Fighter → Fight ← Tag relationships |
| `docs/business-rules.md` | All business logic rules and constraints |
| `docs/architeture-overview.md` | Three-layer architecture explanation and data flow |
| `docs/data-flow.md` | Request → API → Service → Repository → DB flow diagrams |
| `docs/tag-rules.md` | Full tag system design for v2 (hierarchy, voting, custom tags) |
| `docs/tag-types.md` | Reference data for tag types and planned expansions |
| `docs/test-strategy.md` | Testing philosophy: unit (isolated), integration (real DB), BDD (behavior docs) |
| `docs/open_questions.md` | Unresolved questions (e.g., Fighter.team_id nullability, tag hierarchy depth) |
| `docs/openapi.json` | Generated OpenAPI spec (JSON) |
| `docs/code-review-country-2026-01-10.md` | Historical code review of Country implementation |
| `docs/adr/001-use-uuids-for-primary-keys.md` | ADR: Rationale for UUID PKs over auto-increment integers |
| `docs/adr/002-deactivated-flag.md` | ADR: Soft delete pattern using is_deleted boolean |
| `docs/adr/template.md` | Template for new ADRs |
| `docs/session_notes/jan_26.txt` | Session notes — Phase 2A Tag Foundation |
| `docs/session_notes/Jan_27th.txt` | Session notes — Phase 2C CI/CD setup |
| `docs/session_notes/feb_1.txt` | Session notes — Feb 1 |
| `docs/session_notes/feb_2.txt` | Session notes — Feb 2 |
| `docs/session_notes/feb_4.txt` | Session notes — Feb 4 |
| `docs/session_notes/feb_11.txt` | Session notes — Feb 11 |
| `docs/session_notes/feb_17.txt` | Session notes — Feb 17 (most recent) |

---

## `planning/`

| File | Description |
|------|-------------|
| `planning/README.md` | Planning directory overview |
| `planning/PHASE2A_FIGHT_IMPLEMENTATION.md` | Implementation plan for Phase 2B Fight entity |
| `planning/archive/IMPLEMENTATION_PLAN_PHASE2.md` | Archived Phase 2 plan |
| `planning/archive/NEXT_SESSION_*.md` | Archived session plans |

---

## Config & Tooling

| File | Description |
|------|-------------|
| `.github/workflows/test.yml` | GitHub Actions CI/CD; unit + integration tests, coverage reporting to Codecov |
| `.vscode/settings.json` | VS Code editor settings |
| `.vscode/launch.json` | VS Code debugger config for FastAPI |
| `.vscode/tasks.json` | VS Code tasks for running tests and linting |
| `postman/collections/*.json` | Postman API collections for manual endpoint testing |
| `postman/globals/*.json` | Postman workspace global variables |
| `postman/specs/buhurt-fight-tracker.yaml` | OpenAPI spec in YAML |

---

## Quick Entity Lookup

| Entity | Model | Repository | Service | API Controller | Unit Tests (repo) | Unit Tests (service) | Integration Tests |
|--------|-------|------------|---------|----------------|-------------------|----------------------|-------------------|
| Country | `app/models/country.py` | `app/repositories/country_repository.py` | `app/services/country_service.py` | `app/api/v1/countries.py` | `tests/unit/repositories/test_country_repository.py` | `tests/unit/services/test_country_service.py` | `tests/integration/repositories/test_country_repository_integration.py` |
| Team | `app/models/team.py` | `app/repositories/team_repository.py` | `app/services/team_service.py` | `app/api/v1/teams.py` | `tests/unit/repositories/test_team_repository.py` | `tests/unit/services/test_team_service.py` | `tests/integration/repositories/test_team_repository_integration.py` |
| Fighter | `app/models/fighter.py` | `app/repositories/fighter_repository.py` | `app/services/fighter_service.py` | `app/api/v1/fighters.py` | `tests/unit/repositories/test_fighter_repository.py` | `tests/unit/services/test_fighter_service.py` | `tests/integration/repositories/test_fighter_repository_integration.py` |
| Fight | `app/models/fight.py` | `app/repositories/fight_repository.py` | `app/services/fight_service.py` | `app/api/v1/fights.py` | `tests/unit/repositories/test_fight_repository.py` | `tests/unit/services/test_fight_service.py` | `tests/integration/api/test_fight_integration.py` |
| FightParticipation | `app/models/fight_participation.py` | `app/repositories/fight_participation_repository.py` | _(in fight_service)_ | _(in fights.py)_ | `tests/unit/repositories/test_fight_participation_repository.py` | — | — |
| TagType | `app/models/tag_type.py` | `app/repositories/tag_type_repository.py` | `app/services/tag_type_service.py` | `app/api/v1/tag_type_controller.py` | `tests/unit/repositories/test_tag_type_repository.py` | `tests/unit/services/test_tag_type_service.py` | `tests/integration/api/test_tag_type_integration.py` |
| Tag | `app/models/tag.py` | `app/repositories/tag_repository.py` | `app/services/tag_service.py` | `app/api/v1/tag_controller.py` | `tests/unit/repositories/test_tag_repository.py` | `tests/unit/services/test_tag_service.py` | `tests/integration/api/test_tag_integration.py` |
